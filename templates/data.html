<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Sıcaklık Isı Haritası</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  #map { height: 600px; }
</style>
</head>
<body>
<h1>Sıcaklık Isı Haritası</h1>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
  const map = L.map('map').setView([36.8, 30.7], 11);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  fetch('/data') // Buraya senin gerçek API veya json endpoint url koy
    .then(response => {
      if(!response.ok) throw new Error('Veri alınamadı');
      return response.json();
    })
    .then(data => {
      if (!Array.isArray(data) || data.length === 0) {
        alert('Gelen veri boş veya uygun formatta değil.');
        return;
      }

      // heat_index değerlerinin min ve max'ını bul
      const minHeat = Math.min(...data.map(d => d.heat_index));
      const maxHeat = Math.max(...data.map(d => d.heat_index));

      // heatPoints oluştur
      const heatPoints = data.map(d => [
        d.latitude,
        d.longitude,
        (d.heat_index - minHeat) / (maxHeat - minHeat)
      ]);

      // Isı haritası katmanını ekle
      L.heatLayer(heatPoints, {
        radius: 25,
        blur: 15,
        maxZoom: 17,
        max: 1 // normalize edilmiş 0-1 arası değerler kullanıyoruz
      }).addTo(map);

      // Markerları ekle
      data.forEach(d => {
        L.circleMarker([d.latitude, d.longitude], {
          radius: 6,
          color: 'black',
          weight: 1,
          fillColor: '#f03',
          fillOpacity: 0.7
        }).addTo(map).bindPopup(`
          <b>Hissedilen Sıcaklık:</b> ${d.heat_index} °C<br>
          <b>Nem:</b> ${d.humidity} %<br>
          <b>Gerçek Sıcaklık:</b> ${d.temperature} °C
        `);
      });
    })
    .catch(err => {
      console.error('Hata:', err);
      alert('Veri yüklenirken hata oluştu.');
    });
</script>
</body>
</html>
