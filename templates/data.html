<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Dinamik Sıcaklık Haritası</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  #map { height: 600px; }
  .legend {
    position: absolute;
    bottom: 30px;
    left: 20px;
    padding: 10px;
    background: rgba(0,0,0,0.85);
    border-radius: 5px;
    line-height: 1.4;
    font-size: 12px;
    color: white;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
  }
  .legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.9;
  }
</style>
</head>
<body>
<h1>Dinamik Sıcaklık Haritası</h1>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([36.8, 30.7], 11);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  // Sıcaklığa göre renk skalası fonksiyonu
  function getColor(temp) {
    return temp > 40 ? '#d7191c' :
           temp > 35 ? '#fdae61' :
           temp > 30 ? '#ffffbf' :
           temp > 25 ? '#a6d96a' :
                       '#2c7bb6';
  }

  // Veriyi apiLink ile gerçek yerden çekiyoruz
  const apiLink = 'https://senin-site-api.com/data'; // Bunu kendi API'nle değiştir lan

  fetch(apiLink)
    .then(res => res.json())
    .then(data => {
      data.forEach(p => {
        const marker = L.circleMarker([p.latitude, p.longitude], {
          radius: 10,
          color: 'black',
          weight: 1,
          fillColor: getColor(p.temperature),
          fillOpacity: 0.85
        }).addTo(map);

        marker.bindPopup(`
          <b>Hissedilen Sıcaklık:</b> ${p.heat_index}°C<br>
          <b>Nem:</b> ${p.humidity}%<br>
          <b>Gerçek Sıcaklık:</b> ${p.temperature}°C
        `);
      });
    })
    .catch(e => {
      console.error('API verisi çekilirken hata:', e);
      alert('Veri çekilemedi, manual deneyin lan.');
    });

  // Legend ekleyelim
  const legend = L.control({position: 'bottomleft'});
  legend.onAdd = function(map) {
    const div = L.DomUtil.create('div', 'legend');
    const grades = [0, 25, 30, 35, 40];
    const labels = ['<25°C', '25-30°C', '30-35°C', '35-40°C', '>40°C'];
    const colors = ['#2c7bb6','#a6d96a','#ffffbf','#fdae61','#d7191c'];

    for (let i = 0; i < grades.length; i++) {
      div.innerHTML += `<i style="background:${colors[i]}"></i> ${labels[i]}<br>`;
    }
    return div;
  };
  legend.addTo(map);
</script>
</body>
</html>
